# Chapter 0

---

## 대규모 서비스

대규모 서비스란 무엇일까?

-   많은 사용자 트래픽
-   많은 사용자 데이터

단순히 많은 사용자 트래픽과 데이터 뿐만 아니라 데이터가 빠른속도로 증가하는 것을 대규모 서비스라 한다.



>   스타트업에서 서비스의 인기가 좋아서 트래픽이 감당할 수 없을 정도로 늘어난다면?
>
>   그래서 몇일 동안 서비스가 안된다면 어떤일이 벌어질까?
>
>   **우리가 만들 서비스는 이런 트래픽/데이터의 증가에도 문제없이 서비스가 가능해야 한다.**

그래서 어떻게 해야 하는가?



## 대규모 서비스가 가져야 할 특성

1.   확장성 (Elastic)
     -   서비스의 가용용량을 늘이고 줄이는 것이 쉬워야 한다.
2.   장애회복성 (Resiliency)
     -   서비스에 장애가 일어났을 때 가능한 사람의 수동적인 처리 없이 자동적으로 회복되어야 한다.
3.   자동화 (Automation)
     -   배포부터 장애처리 등 대부분 자동화되어서 버튼 클릭 한 두번 정도로 진행되어야 한다.
     -   물론 100% 는 안되겠지만, 적어도 예상가능한 부분(서버를 런치한다던지, 인프라를 새로 구성한다던지)은 자동화되어야한다.
4.   모니터링 (Monitoring)
     -   서비스 상태는 항상 모니터링 가능해야 한다.



### 1. 확장성

**트래픽이 늘어나서 서버를 추가해야 한다면?**

-   추가가 되어야 하는 서버의 종류는?
    -   Web Server나 DB Server가 있을 수 있다.



**트래픽이 줄어서 서버를 줄여야 한다면?**

-   제거가 되어야 하는 서버의 종류는?



### 2. 장애회복성

**서비스 중인 API 서버 중 한 두대가 장애가 나거나 DB서버가 장애가 나면 서비스는 계속 지속될 수 있을까?**



이런 장애회복을 위해서 **failover**라던지 **replication**을 수행하게 된다.

자동으로 서비스에서 빠지거나 대체되어야 한다.



#### > SPOF

또한 장애회복성을 위해서는 **SPOF**가 없어져야 한다.

>   Single Point of Failure
>
>   해당 지점에 장애가 발생하면 전체 서비스에 장애를 낼 수 있는 부분

이렇게 중요한 서버 뿐만 아니라 중요하지 않은 곳에서도 SPOF가 일어날 수 있다.

중요하지 않은 서버라고 하더라도 어느 한 곳에서 장애가 나면 에러처리가 안되서 결과값이 항상 에러를 반환한다면 SPOF가 발생하게 되는 것이다.

대부분의 서버는 이런 SPOF를 줄이는 것이 목적이다



**`Client <-> API Server <-> DB Server` 중 API 서버가 죽는다면 어떻게 될까?**

사용자에게 전달이 될 수 없고 서비스 장애가 발생하게 되는 것이다. 이 때 API 서버가 SPOF가 되는 것이다.

***한대의 물리 서버는 반드시 SPOF가 존재한다.***



SPOF를 제거하기 위한 방법에는 어떤 것이 있을까?

1.   API 서버를 증설한다.
2.   DB 서버의 Replication

SPOF가 한 군데라도 있으면 문제는 계속 발생하게 된다. 전체적으로 모든 SPOF를 없애야만 안정적인 서비스를 운영할 수 있다. 따라서 **모든 부분에서 최소 이중화가 되어야 한다.**



#### > 이 외에도 SPOF가 발생할 수 있는 부분들

서버 이외에도 SPOF가 발생할 수 있는 부분은 굉장히 많다.

ex) `Switch, Router` 등의 하드웨어 부분, 전용선이 끊기는 부분?!



스위치의 한계도 있다.

보통 서버들은 스위치에 물려 있는데 스위치의 **Bandwidth**의 한계를 넘어가는 트래픽이 발생한다면 문제가 발생한다..

1.   10G 스위치에 10Gbps 이상의 데이터가 전달될 수 있을까? 만약에 전달된다면?
2.   서버의 Capacity를 넘어가는 순간부터 패킷 드랍이 발생한다.



또한 스위치가 장애가 날 수 있으므로 이중화가 필요하다.(사람이 만든 것이기 때문에 !)



***따라서 SPOF를 최대한 제거하고, 각 부분들을 확장할 수 있어야 한다.***



### 3. 자동화

-   서비스 운영의 많은 부분이 자동화가 되어야 한다.
    -   사람이 손으로 직접 건드리는 것은 새로운 장애의 씨앗이 된다.
-   IaC(Infrastructure as Code)가 중요하다.

#### > On-Premis

-   보통 `On-Premis`에서 장비 준비는 인프라팀의 도움이 필요하다. (대기업)
-   일부 기업에서는 이런 부분도 API를 이용하기 위해 `Private-Cloud`등을 도입하기도 한다.
-   OS나 기본적 네트웍 설정 포함 모든 설정을 설치 스크립트 하나로 처리가 되어야 한다.



#### > Cloud

-   필요한 인프라(서버, 그 외의 클라우드 제공 서비스)는 IaC로 생성한다.
    -   보통 `Terraform`이 가장 유명하다.
-   특정 이미지를 모두 만들어 둘 수도 있고, `Terraform`으로 인프라를 구성한 후에 `ansible`로 필요한 설정을 추가할 수도 있다.